syntax = "proto3";

package monarchic.agent_protocol.v1;

import "google/protobuf/struct.proto";

option java_package = "ai.monarchic.agent_protocol.v1";
option java_outer_classname = "MonarchicAgentProtocolV1";
option java_multiple_files = true;
option csharp_namespace = "Monarchic.AgentProtocol.V1";
option objc_class_prefix = "MAP";
option php_namespace = "Monarchic\\AgentProtocol\\V1";
option php_metadata_namespace = "Monarchic\\AgentProtocol\\V1\\Metadata";
option go_package = "github.com/monarchic-ai/monarchic-agent-protocol/src/go/monarchic/agent_protocol/v1;agent_protocolv1";

enum AgentRole {
  AGENT_ROLE_UNSPECIFIED = 0;
  PRODUCT_OWNER = 1;
  PROJECT_MANAGER = 2;
  DEV = 3;
  QA = 4;
  REVIEWER = 5;
  SECURITY = 6;
  OPS = 7;
}

message DatasetRef {
  string dataset_id = 1;
  optional string uri = 2;
  string sha256 = 3;
  string format = 4;
  optional string split = 5;
  optional uint64 size_bytes = 6;
  optional string description = 7;
  google.protobuf.Struct extensions = 8;
}

message AcceptanceCriteria {
  string metric = 1;
  string direction = 2;
  double threshold = 3;
  optional double min_effect_size = 4;
  optional double max_variance = 5;
  optional double confidence_level = 6;
  google.protobuf.Struct extensions = 7;
}

message ExperimentSpec {
  string experiment_id = 1;
  string objective = 2;
  optional string hypothesis = 3;
  optional string model_family = 4;
  repeated int64 seeds = 5;
  repeated DatasetRef dataset_refs = 6;
  AcceptanceCriteria acceptance = 7;
  google.protobuf.Struct constraints = 8;
  google.protobuf.Struct extensions = 9;
}

message DeliveryContract {
  string objective = 1;
  repeated string definition_of_done = 2;
  repeated string required_checks = 3;
  string risk_tier = 4;
  optional uint32 max_cycle_minutes = 5;
  optional uint32 max_agent_turns = 6;
  optional string pr_strategy = 7;
  optional string review_policy = 8;
  optional string rollback_strategy = 9;
  optional string notes = 10;
  google.protobuf.Struct extensions = 11;
}

message EvalResult {
  string metric = 1;
  double value = 2;
  optional double lower_ci = 3;
  optional double upper_ci = 4;
  optional double variance = 5;
  optional int64 seed = 6;
  bool passed = 7;
  optional string notes = 8;
  google.protobuf.Struct extensions = 9;
}

message Provenance {
  string prompt_sha256 = 1;
  string code_sha256 = 2;
  repeated string dataset_sha256 = 3;
  string runtime = 4;
  optional string model = 5;
  string runner = 6;
  string orchestrator = 7;
  optional string task_spec_sha256 = 8;
  optional string pipeline_sha256 = 9;
  optional string command_sha256 = 10;
  string created_at = 11;
  optional string source_task_id = 12;
  repeated DatasetRef dataset_refs = 13;
  google.protobuf.Struct extensions = 14;
}

message Task {
  string version = 1;
  string task_id = 2;
  AgentRole role = 3;
  string goal = 4;
  google.protobuf.Struct inputs = 5;
  google.protobuf.Struct constraints = 6;
  repeated string gates_required = 7;
  RunContext run_context = 8;
  google.protobuf.Struct extensions = 9;
  ExperimentSpec experiment_spec = 10;
  DeliveryContract delivery_contract = 11;
}

message Artifact {
  string version = 1;
  string artifact_id = 2;
  string type = 3;
  string summary = 4;
  string path = 5;
  string task_id = 6;
  google.protobuf.Struct extensions = 7;
  Provenance provenance = 8;
  repeated DatasetRef dataset_refs = 9;
  repeated EvalResult eval_results = 10;
  ExperimentSpec experiment_spec = 11;
}

message Event {
  string version = 1;
  string event_type = 2;
  string timestamp = 3;
  string task_id = 4;
  string status = 5;
  optional string message = 6;
  google.protobuf.Struct extensions = 7;
  Provenance provenance = 8;
  repeated EvalResult eval_results = 9;
}

message GateResult {
  string version = 1;
  string gate = 2;
  string status = 3;
  optional string reason = 4;
  google.protobuf.Struct evidence = 5;
  google.protobuf.Struct extensions = 6;
}

message RunContext {
  string version = 1;
  string repo = 2;
  string worktree = 3;
  string image = 4;
  string runner = 5;
  repeated string labels = 6;
  google.protobuf.Struct extensions = 7;
}
